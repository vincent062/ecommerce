<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Sunset Shop{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>üåÖ</text></svg>">
        <script src="https://cdn.tailwindcss.com"></script>
        
        {# Petite animation pour le badge du panier #}
        <style>
            @keyframes bounce-short {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-25%); }
            }
            .animate-badge {
                animation: bounce-short 0.5s ease-in-out;
            }
        </style>

        {% block stylesheets %}{% endblock %}

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>
    <body class="bg-stone-50 flex flex-col min-h-screen font-sans">
        
        {# --- 1. LOGIQUE DE COMPTAGE DU PANIER (Magie Twig) --- #}
        {% set cart_count = 0 %}
        {# On v√©rifie si la session existe, puis on additionne les quantit√©s #}
        {% if app.session %}
            {% for count in app.session.get('cart', []) %}
                {% set cart_count = cart_count + count %}
            {% endfor %}
        {% endif %}
        {# ---------------------------------------------------- #}

        {# --- 2. BARRE DE NAVIGATION (NAVBAR) --- #}
        
                    {# ACTIONS #}
<nav class="w-full bg-white/90 backdrop-blur-md border-b border-stone-100 sticky top-0 z-50">
    {# LE CONTENEUR PRINCIPAL #}
    {# w-full : prend toute la largeur #}
    {# flex : active le mode alignement #}
    {# justify-between : PROJETTE le logo √† gauche et le reste √† droite #}
    <div class="w-full container mx-auto px-4 h-20 flex items-center justify-between">
        
        {# --- 1. GAUCHE : LE LOGO --- #}
        <a href="{{ path('app_home') }}" class="flex items-center gap-2 group">
            <div class="w-9 h-9 bg-stone-900 rounded-full flex items-center justify-center text-white font-serif font-bold text-lg group-hover:bg-rose-600 transition duration-300">
                G
            </div>
            <span class="text-2xl font-serif font-bold text-stone-900 tracking-tight">
                Golden <span class="text-rose-600 group-hover:text-stone-900 transition duration-300">Hour</span>.
            </span>
        </a>

        {# --- 2. DROITE : LES ACTIONS (Panier + Connexion) --- #}
        <div class="flex items-center gap-6">
            
            {# Lien Admin (Invisible pour les clients) #}
            {% if is_granted('ROLE_ADMIN') %}
                <a href="/admin" class="hidden md:block text-rose-600 text-xs font-bold border border-rose-200 bg-rose-50 px-3 py-1 rounded-full hover:bg-rose-100 transition">
                    Admin
                </a>
            {% endif %}

            {# BOUTON PANIER #}
            <a href="{{ path('cart_index') }}" class="relative group p-1">
                <div class="text-stone-600 group-hover:text-orange-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </div>
                
                {# Calcul du nombre total d'articles #}
                {% set cart = app.session.get('cart', []) %}
                {% set totalQty = 0 %}
                {% for qty in cart %}
                    {% set totalQty = totalQty + qty %}
                {% endfor %}

                {# Bulle rouge (Seulement si panier non vide) #}
                {% if totalQty > 0 %}
                    <span class="absolute -top-1 -right-1 bg-rose-600 text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full border-2 border-white shadow-sm animate-bounce">
                        {{ totalQty }}
                    </span>
                {% endif %}
            </a>

            {# S√âPARATEUR VERTICAL #}
            <div class="h-6 w-px bg-stone-200"></div>

            {# BOUTON COMPTE / CONNEXION #}
            {% if app.user %}
                {# SI CONNECT√â #}
                <a href="{{ path('app_account') }}" class="flex items-center gap-3 group">
                    <div class="text-right hidden md:block">
                        <p class="text-[10px] text-stone-400 font-bold uppercase tracking-widest">Mon compte</p>
                        <p class="text-sm font-bold text-stone-900 group-hover:text-rose-600 transition">{{ app.user.firstname }}</p>
                    </div>
                    <div class="h-9 w-9 bg-stone-100 rounded-full flex items-center justify-center text-stone-600 font-serif font-bold group-hover:bg-rose-100 group-hover:text-rose-600 transition border border-stone-200">
                        {{ app.user.firstname|first|upper }}
                    </div>
                </a>
            {% else %}
                {# SI PAS CONNECT√â #}
                <a href="{{ path('app_login') }}" class="flex items-center gap-2 text-sm font-bold text-stone-900 hover:text-rose-600 transition bg-stone-50 hover:bg-stone-100 px-4 py-2 rounded-full border border-stone-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                    </svg>
                    Connexion
                </a>
            {% endif %}

        </div>
    </div>
</nav>
                    </div>
        {# --- 3. CONTENU DES PAGES --- #}
        <main class="flex-grow">
        {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}
            {% block body %}{% endblock %}
        </main>

        {# --- 4. FOOTER SIMPLE --- #}
        <footer class="bg-stone-900 text-stone-400 py-12 border-t border-stone-800">
            <div class="container mx-auto px-4 text-center">
                <p class="font-medium mb-4">Fait avec ‚ù§Ô∏è pour le code</p>
            <p class="text-xs text-stone-600">
                <a href="/admin" class="text-stone-600 hover:text-stone-800 cursor-default transition-colors no-underline">
                    &copy;
                </a> 
        {{ 'now'|date('Y') }} Cr√©a'Tech. Tous droits r√©serv√©s.
            </p>

            </div>
        </footer>

    </body>
</html>