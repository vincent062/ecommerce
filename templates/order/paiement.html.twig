{% extends 'base.html.twig' %}

{% block title %}Valider ma commande - Sunset Shop{% endblock %}

{% block body %}
{# FOND COLOR√â ET CHALEUREUX (Radial gradient) #}
<div class="min-h-screen py-12 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-orange-200/60 via-rose-50 to-orange-300/50">
    <div class="container mx-auto px-4 max-w-6xl">
        
        <h1 class="text-4xl font-black text-stone-800 mb-10 flex items-center gap-4 drop-shadow-sm">
            <span class="bg-gradient-to-br from-orange-400 to-rose-400 text-white p-3 rounded-2xl shadow-lg shadow-orange-500/20">üöö</span>
            Finaliser ma commande
        </h1>

        <form action="#" method="POST"> 
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                
                {# COLONNE GAUCHE : ADRESSES #}
                <div class="lg:col-span-2 space-y-8">
                    
                    {# CARTE PRINCIPALE AVEC GROSSE OMBRE ORANGE #}
                    <div class="bg-white p-8 rounded-[2rem] border border-orange-100/50 shadow-[0_20px_50px_-15px_rgba(249,115,22,0.3),_0_40px_90px_-30px_rgba(249,115,22,0.2)] relative z-10">
                        <h2 class="text-2xl font-bold mb-8 text-stone-800 flex items-center">
                            1. Adresse de livraison
                        </h2>

                        {% if addresses is empty %}
                             <div class="text-center py-8 bg-orange-50/50 rounded-2xl border border-orange-100 border-dashed">
                                <p class="text-stone-600 mb-4 font-medium">O√π devons-nous envoyer votre colis ?</p>
                                <a href="{{ path('account_address_add') }}" class="inline-block px-6 py-3 bg-white text-stone-800 border border-stone-200 rounded-xl font-bold hover:bg-orange-50 hover:border-orange-200 hover:text-orange-600 transition shadow-sm">
                                    + Ajouter une adresse
                                </a>
                            </div>
                        {% else %}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                {% for address in addresses %}
                                    <label class="cursor-pointer relative group">
                                        <input type="radio" name="delivery_address" value="{{ address.id }}" class="peer sr-only" required {% if loop.first %}checked{% endif %}>
                                        
                                        {# Petite carte d'adresse s√©lectionnable #}
                                        <div class="p-6 rounded-2xl bg-white border-2 border-stone-100 shadow-md hover:shadow-xl group-hover:shadow-orange-200/50 peer-checked:border-orange-500 peer-checked:bg-orange-50/40 peer-checked:shadow-[0_10px_25px_-5px_rgba(249,115,22,0.4)] transition-all duration-300 h-full transform group-hover:-translate-y-1">
                                            <div class="flex justify-between items-start mb-3">
                                                <span class="font-bold text-stone-800 text-lg">{{ address.name }}</span>
                                                {# Puce radio #}
                                                <div class="w-7 h-7 rounded-full border-2 border-stone-300 peer-checked:bg-gradient-to-r peer-checked:from-orange-500 peer-checked:to-rose-600 peer-checked:border-transparent flex items-center justify-center transition shadow-sm">
                                                    <div class="w-2.5 h-2.5 bg-white rounded-full shadow-sm scale-0 peer-checked:scale-100 transition-transform"></div>
                                                </div>
                                            </div>
                                            <div class="text-stone-600 leading-relaxed font-medium">
                                                {{ address.firstname }} {{ address.lastname }}<br>
                                                {{ address.address }}<br>
                                                {{ address.zipcode }} {{ address.city }}<br>
                                                <span class="text-orange-800/60 font-bold tracking-wide">{{ address.country }}</span>
                                            </div>
                                        </div>
                                    </label>
                                {% endfor %}
                            </div>
                            
                             <div class="mt-8">
                                <a href="{{ path('account_address_add') }}" class="inline-flex items-center gap-2 px-5 py-3 bg-orange-50 text-orange-700 font-bold rounded-xl hover:bg-orange-100 transition">
                                    <span class="text-xl leading-none">+</span> Ajouter une nouvelle adresse
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>

                {# COLONNE DROITE : R√âCAP #}
                <div class="lg:col-span-1 sticky top-8">
                    {# CARTE R√âCAP AVEC GROSSE OMBRE #}
                    <div class="bg-white p-8 rounded-[2rem] border border-orange-100/50 shadow-[0_20px_50px_-15px_rgba(249,115,22,0.3),_0_40px_90px_-30px_rgba(249,115,22,0.2)] relative z-10">
                        <h3 class="text-xl font-black text-stone-800 mb-8 flex justify-between items-center">
                            Ma commande
                            <span class="text-sm font-bold bg-orange-100 text-orange-700 px-3 py-1.5 rounded-xl shadow-sm">{{ cart|length }} articles</span>
                        </h3>
                        
                        <div class="space-y-6 mb-8">
                            {% for item in cart %}
                                <div class="flex gap-4 items-center group">
                                    <div class="w-16 h-16 rounded-2xl overflow-hidden bg-white border-2 border-orange-50 shadow-sm group-hover:shadow-md transition">
                                        <img src="/uploads/{{ item.product.image }}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="text-sm font-bold text-stone-800 line-clamp-2 leading-tight">{{ item.product.name }}</h4>
                                        <p class="text-xs text-stone-500 mt-1 font-medium bg-stone-100 inline-block px-2 py-0.5 rounded-md">Qt√©: {{ item.quantity }}</p>
                                    </div>
                                    <div class="text-base font-black text-stone-700">
                                        {{ ((item.product.price * item.quantity) / 100) }} ‚Ç¨
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="border-t-2 border-dashed border-orange-100/50 pt-6 space-y-3">
                             <div class="flex justify-between text-stone-600 font-medium">
                                <span>Sous-total</span>
                                <span>{{ total / 100 }} ‚Ç¨</span>
                            </div>
                            <div class="flex justify-between text-stone-600 font-medium items-center">
                                <span>Livraison</span>
                                <span class="text-green-700 bg-green-50 px-2 py-1 rounded-lg text-sm font-bold">Offerte üéÅ</span>
                            </div>
                            <div class="flex justify-between items-center pt-4">
                                <span class="text-2xl font-black text-stone-800">Total</span>
                                <span class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-rose-600 drop-shadow-sm">
                                    {{ total / 100 }} ‚Ç¨
                                </span>
                            </div>
                        </div>

                        <button type="submit" class="w-full mt-8 py-5 text-lg bg-gradient-to-r from-stone-900 to-stone-800 text-white font-bold rounded-2xl hover:from-orange-600 hover:to-rose-600 transition-all duration-300 shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] hover:shadow-[0_20px_40px_-10px_rgba(249,115,22,0.5)] transform hover:-translate-y-1">
                            Payer maintenant
                        </button>
                        
                        <p class="text-center text-xs text-stone-400 mt-5 flex justify-center items-center gap-2 font-medium">
                            <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg>
                            Paiement 100% s√©curis√© SSL
                        </p>
                    </div>
                </div>

            </div>
        </form>
    </div>
</div>
{% endblock %}